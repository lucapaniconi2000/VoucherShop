# VoucherShop ðŸ§¾ðŸŽ´

VoucherShop is a .NET Web API for card shops (e.g., MTG) to manage **store credit vouchers** generated by tournaments.

- A **User** logs in and sees their voucher **balance**, **last update**, and **expiration**.
- An **Admin** (shop owner) can **create/update** a userâ€™s voucher and view the **audit history** of changes.

The project supports **Shop/Tenant** separation (multi-tenant) via `shop_id` in JWTs. It can also be used as **single-shop** by creating only one shop.

**Language:** English | [Italiano](README.it.md)

---

## What this project does

### Core domain
- Each `Shop` has a `Currency` (e.g., `EUR`).
- Each `User` belongs to a `Shop` (`ShopId`).
- Each `Voucher` is unique per `(ShopId, UserId)` (one voucher per user per shop).
- Voucher balance is modeled as `Money` (value object). Expiration is handled in the domain.

### Roles
- **Admin**
  - creates users inside their shop
  - creates/updates vouchers
  - reads voucher audit history
- **User**
  - reads their voucher via `/api/me/voucher`

---

## Features
- âœ… Clean Architecture (Domain / Application / Infrastructure / Api)
- âœ… Multi-tenant via `shop_id` claim in JWT
- âœ… ASP.NET Identity + JWT + Refresh Token (HttpOnly cookie)
- âœ… CQRS with MediatR (Commands + Queries)
- âœ… EF Core + PostgreSQL (Docker)
- âœ… Swagger/OpenAPI
- âœ… Voucher audit history

---

## Tech stack
- .NET 8 (LTS)
- ASP.NET Core Web API
- EF Core + Npgsql provider
- PostgreSQL (docker-compose)
- ASP.NET Identity
- JWT + Refresh Token
- MediatR
- Swagger

---

## Solution structure (Clean Architecture)
- `VoucherShop.Domain` â€” Entities + Value Objects (`Voucher`, `Money`, `Shop`, `AuditLog`)
- `VoucherShop.Application` â€” Use cases (CQRS), Interfaces, DTOs
- `VoucherShop.Infrastructure` â€” EF Core DbContext, Identity, Repositories, JWT services
- `VoucherShop.Api` â€” Controllers, Swagger, pipeline, DI composition root

---

## Prerequisites
- .NET SDK 8.x
- Docker Desktop
- (Optional) pgAdmin / DBeaver / DataGrip

---

## Quickstart (Development)

### 1) Start PostgreSQL via Docker
From repository root:

```bash
docker compose up -d
